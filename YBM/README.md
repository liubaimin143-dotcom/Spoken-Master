# YBM TOEIC å¤‡è€ƒç³»ç»Ÿ - éœ€æ±‚æ–‡æ¡£

> ğŸ“… è€ƒè¯•æ—¥æœŸï¼š2026å¹´4æœˆ19æ—¥  
> â° å‰©ä½™æ—¶é—´ï¼šçº¦80å¤©  
> ğŸ“ æœ€åæ›´æ–°ï¼š2026å¹´1æœˆ29æ—¥

---

## ğŸ¯ ç—›ç‚¹åˆ†æ

| åºå· | ç—›ç‚¹ | æè¿° |
|------|------|------|
| 1 | å¬åŠ›è¯†åˆ« | å¬åˆ°å•è¯ä¸è®¤è¯† |
| 2 | è¯ç»„çŸ­è¯­ | è¯ç»„ã€çŸ­è¯­ã€å›ºå®šæ­é…èƒŒå¾—å°‘ |
| 3 | ä¸“ä¸šè¯æ±‡ | å•†ä¸šè‹±è¯­ç­‰ä¸“ä¸šè¯æ±‡äº†è§£å°‘ |

---

## ï¸ æŠ€æœ¯æ ˆ

| èµ„æº | è¯¦æƒ… | çŠ¶æ€ |
|------|------|------|
| **å‰ç«¯æ¡†æ¶** | React + TypeScript + Vite | âœ… å·²æ­å»º |
| **åç«¯æœåŠ¡** | FastAPI (Python) | âœ… å·²å®ç° |
| **æ•°æ®åº“** | **PostgreSQL 17** | âœ… å·²å®‰è£…è¿è¡Œ |
| **Whisper æ¨¡å‹** | `whisper-large-v3-turbo` | âœ… å·²ä¸‹è½½ |
| **LLM API** | Gemini 3 Flash / Pro High | âœ… å·²é…ç½® |
| **æ˜¾å¡** | RTX 4080 12GB | âœ… å¯ç”¨ |

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
SpokenMaster/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/Layout/    # ğŸ”’ å¸ƒå±€ç»„ä»¶ï¼ˆä¾§è¾¹æ ã€èƒŒæ™¯ï¼‰
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ Studio/           # ç´ æå·¥åŠï¼ˆAI è°ƒæ•™å·¥ä½œå°ï¼‰
â”‚   â”‚   â””â”€â”€ Listening/        # å¬åŠ›å·¥åŠ
â”‚   â””â”€â”€ App.tsx               # è·¯ç”±ï¼ˆé»˜è®¤è·³è½¬ /studioï¼‰
â”œâ”€â”€ Model/
â”‚   â”œâ”€â”€ server.py             # Whisper + API æœåŠ¡
â”‚   â”œâ”€â”€ prompts.json          # ç³»ç»Ÿæç¤ºè¯é…ç½®
â”‚   â”œâ”€â”€ glossary.json         # æœ¯è¯­åº“
â”‚   â”œâ”€â”€ ai_config.json        # AI API é…ç½®
â”‚   â””â”€â”€ Whisper/              # æ¨¡å‹æ–‡ä»¶
â””â”€â”€ ...
```

---

## ğŸ¨ ç´ æå·¥åŠ (Material Studio)

### é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header: Material Studio                    [ğŸ“¤ ä¸Šä¼ ] [âš™ï¸ APIè®¾ç½®]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ ç³»ç»Ÿæç¤ºè¯                  â”‚ ğŸ“š æœ¯è¯­åº“ (N)                       â”‚
â”‚                               â”‚                                     â”‚
â”‚ [å¯ç¼–è¾‘çš„ prompt å†…å®¹]         â”‚ budget â†’ é¢„ç®— (noun)               â”‚
â”‚                               â”‚ make a reservation â†’ é¢„çº¦ (phrase) â”‚
â”‚ [ğŸ’¾ ä¿å­˜]                     â”‚ [+ æ·»åŠ ]                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¤ è¾“å…¥å†…å®¹                    â”‚ ğŸ“¥ AI è¿”å›                          â”‚
â”‚                               â”‚                                     â”‚
â”‚ [Whisper å¬å†™ç»“æœè‡ªåŠ¨å¡«å…¥]      â”‚ [æµå¼è¾“å‡ºï¼Œé€å­—æ˜¾ç¤º]                â”‚
â”‚                               â”‚                                     â”‚
â”‚ [ğŸš€ å‘é€ç»™ AI]                â”‚ [ğŸ“‹ å¤åˆ¶]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŠŸèƒ½æŒ‰é’®

| æŒ‰é’® | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| ğŸ“¤ ä¸Šä¼  | ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ | è¯­è¨€é€‰æ‹©ã€åˆ†ç±»é€‰æ‹©ï¼ŒWhisper å¬å†™ |
| âš™ï¸ APIè®¾ç½® | é…ç½® API | Whisper URLï¼ˆå¯æµ‹è¯•ï¼‰ã€LLM API Keyã€æ¨¡å‹é€‰æ‹©ï¼ˆå¯æµ‹è¯•ï¼‰ |

### çƒ­åŒæ­¥æœºåˆ¶

- **å‰ç«¯ â†’ åç«¯**ï¼šä¿å­˜æŒ‰é’®å†™å…¥ `prompts.json` / `glossary.json`
- **åç«¯ â†’ å‰ç«¯**ï¼šæ¯ 2 ç§’è½®è¯¢ `/files/timestamps`ï¼Œæ£€æµ‹æ–‡ä»¶å˜åŒ–è‡ªåŠ¨åˆ·æ–°
- æ”¯æŒç›´æ¥ç¼–è¾‘ JSON æ–‡ä»¶ï¼Œå‰ç«¯è‡ªåŠ¨æ›´æ–°

### æµå¼ AI å¯¹è¯

- å‚è€ƒ `my-story` é¡¹ç›®çš„ SSE å®ç°
- åç«¯ä½¿ç”¨ `StreamingResponse` é€ä¼ ä¸Šæ¸¸ API æ•°æ®
- å‰ç«¯ä½¿ç”¨ `ReadableStream` + `TextDecoder` é€å—è§£ç 

---

## ğŸ“– æœ¯è¯­åº“ (Glossary)

ç”¨äºçº¦æŸ AI è¾“å‡ºï¼Œä¿æŒç¿»è¯‘ä¸€è‡´æ€§ã€‚

```json
{
  "id": "uuid",
  "english": "budget",
  "chinese": "é¢„ç®—",
  "pos": "noun",
  "domain": "business",
  "notes": "TOEIC é«˜é¢‘è¯"
}
```

**API ç«¯ç‚¹**ï¼š
- `GET /glossary` - è·å–å…¨éƒ¨
- `POST /glossary` - æ·»åŠ 
- `PUT /glossary/{id}` - æ›´æ–°
- `DELETE /glossary/{id}` - åˆ é™¤

---

## ğŸ—„ï¸ PostgreSQL æ•°æ®åº“è®¾è®¡

### è¡¨ç»“æ„

```sql
-- æœ¯è¯­åº“
CREATE TABLE glossary (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    english TEXT NOT NULL,
    chinese TEXT NOT NULL,
    pos TEXT,                    -- noun, verb, phrase, etc.
    domain TEXT,                 -- business, travel, office
    notes TEXT,
    source TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- éŸ³é¢‘æ–‡ä»¶
CREATE TABLE audio_files (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    filename TEXT NOT NULL,
    filepath TEXT NOT NULL,
    duration REAL,
    category TEXT,               -- TOEIC, CET6
    transcription JSONB,         -- Whisper ç»“æœ
    created_at TIMESTAMP DEFAULT NOW()
);

-- å­¦ä¹ è¯æ¡
CREATE TABLE vocabulary (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    english TEXT NOT NULL,
    chinese TEXT NOT NULL,
    pos TEXT,
    context TEXT,
    audio_file_id UUID REFERENCES audio_files(id),
    audio_start REAL,
    audio_end REAL,
    source TEXT,
    glossary_id UUID REFERENCES glossary(id),
    created_at TIMESTAMP DEFAULT NOW()
);

-- å­¦ä¹ è®°å½•
CREATE TABLE learning_records (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    vocabulary_id UUID REFERENCES vocabulary(id),
    status TEXT,                 -- warming, excellent, fair, weak, confused
    last_review TIMESTAMP,
    next_review TIMESTAMP,
    review_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

## ğŸš€ å¼€å‘çŠ¶æ€

### Sprint 1: ç´ æå·¥åŠåŸå‹ âœ… å®Œæˆ

| åŠŸèƒ½ | çŠ¶æ€ |
|------|------|
| é¡µé¢æ¡†æ¶ | âœ… |
| ä¸Šä¼ æŒ‰é’® + å¼¹å‡ºé¢æ¿ | âœ… |
| APIè®¾ç½®æŒ‰é’® + å¼¹å‡ºé¢æ¿ | âœ… |
| Whisper è¿æ¥æµ‹è¯• | âœ… |
| LLM è¿æ¥æµ‹è¯• | âœ… |
| AI è°ƒæ•™å·¥ä½œå°ï¼ˆå››è±¡é™ï¼‰ | âœ… |
| ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘/ä¿å­˜ | âœ… |
| æœ¯è¯­åº“ç®¡ç† | âœ… |
| æµå¼ AI å¯¹è¯ | âœ… |
| Whisper ç»“æœè‡ªåŠ¨å¡«å…¥ | âœ… |
| çƒ­åŒæ­¥æœºåˆ¶ | âœ… |

### Sprint 2: æ•°æ®æŒä¹…åŒ– âœ… å®Œæˆ

| åŠŸèƒ½ | çŠ¶æ€ |
|------|------|
| PostgreSQL è¿æ¥é…ç½® | âœ… |
| è¯æ±‡æ•°æ®åº“æ¨¡å‹ | âœ… |
| éŸ³é¢‘æ–‡ä»¶å…ƒæ•°æ®ç®¡ç† | âœ… |
| FSRS é—´éš”å¤ä¹ é›†æˆ | âœ… |
| Edge-TTS ä¸­æ–‡è¯­éŸ³åˆæˆ | âœ… |

### Sprint 3: å¬åŠ›å·¥åŠ âœ… å®Œæˆ

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| ä¸»é¡µé¢å¸ƒå±€ | âœ… | å·¦ä¾§å­¦ä¹ åŒºåŸŸ + å³ä¾§ç»Ÿè®¡é¢æ¿ |
| æ¨¡å¼åˆ‡æ¢ | âœ… | ç£¨è€³æœµ / è€ƒæ ¸ ä¸¤ç§æ¨¡å¼ |
| Tab åˆ†ç»„ | âœ… | çŸ­è¯­ / è¯æ±‡ / ä¸ä¼šçš„ / å…¨éƒ¨ |
| é—ªå¡ç»„ä»¶ | âœ… | 3D ç¿»è½¬æ•ˆæœï¼Œæ­£é¢æ’­æ”¾/èƒŒé¢è¯¦æƒ… |
| è¯æ±‡æ± å¯è§†åŒ– | âœ… | æ–°è¯/å­¦ä¹ ä¸­/å¤ä¹ /é‡å­¦ç»Ÿè®¡ |
| Gemini æ™ºèƒ½é¢æ¿ | âœ… | **å¼¹çª—å¼**ï¼Œå­¦ä¹ è§„åˆ’ + é˜Ÿåˆ—ä¼˜åŒ– |
| æ’­æ”¾èŠ‚å¥è®¾ç½® | âœ… | **å¼¹çª—å¼**ï¼Œå¯è°ƒèŠ‚å„ç§é—´éš”æ—¶é—´ |
| éŸ³é¢‘æ’­æ”¾æ§åˆ¶å™¨ | âœ… | 3éè‹±è¯­ + 1éä¸­æ–‡å¾ªç¯æ’­æ”¾ |
| é¼ æ ‡ä¾§é”®æ•è· | âœ… | è€ƒæ ¸æ¨¡å¼ï¼šä¸Šä¾§é”®"ä¼š"ã€ä¸‹ä¾§é”®"ä¸ä¼š" |
| FSRS å¤ä¹ é€»è¾‘ | âœ… | py-fsrs 6.3.0 ç®—æ³•é›†æˆ |
| åç«¯ API | âœ… | 10+ ç«¯ç‚¹å®Œæ•´å®ç° |

---

## ğŸ§ å¬åŠ›å·¥åŠ (Listening Workshop)

### é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¬åŠ›å·¥åŠ                                    [ğŸ§ ç£¨è€³æœµ] [ğŸ“ è€ƒæ ¸]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [çŸ­è¯­ 12] [è¯æ±‡ 25] [ä¸ä¼šçš„ 3] [å…¨éƒ¨ 40]                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                   â”‚  ğŸ“Š è¯æ±‡æ±                           â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚  â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘ æ–°è¯: 12               â”‚
â”‚          â”‚    ğŸ”Š       â”‚          â”‚                                     â”‚
â”‚          â”‚  è‹±è¯­ 2/3   â”‚          â”‚  âœ¨ Gemini æ™ºèƒ½åŠ©æ‰‹  â†’  (å¼¹çª—)      â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â±ï¸ æ’­æ”¾èŠ‚å¥è®¾ç½®    â†’  (å¼¹çª—)      â”‚
â”‚        [â—€] [â­ æ ‡è®°ä¸ä¼š] [â–¶]       â”‚                                     â”‚
â”‚                                   â”‚                                     â”‚
â”‚          [â–¶ å¼€å§‹å­¦ä¹ ]              â”‚                                     â”‚
â”‚                                   â”‚                                     â”‚
â”‚  â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 15/40            â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç£¨è€³æœµæ¨¡å¼ (Grinding)

1. è‡ªåŠ¨æ’­æ”¾ï¼šè‹±è¯­ 3 é â†’ ä¸­æ–‡ 1 é â†’ ä¸‹ä¸€ä¸ªå•è¯
2. å¯éšæ—¶ç‚¹å‡»"æ ‡è®°ä¸ä¼š"
3. å¾ªç¯ç›´åˆ°ç”¨æˆ·ç‚¹å‡»"ç»“æŸ"
4. Gemini ä¼˜åŒ–æ’­æ”¾é˜Ÿåˆ—é¡ºåº

### è€ƒæ ¸æ¨¡å¼ (Assessment)

1. æ’­æ”¾è‹±è¯­ 1 é
2. é¼ æ ‡ä¸Šä¾§é”®ï¼šæ’­æ”¾ä¸­æ–‡ï¼ˆå†æ¬¡ç‚¹å‡»ç¡®è®¤"ä¼š"ï¼‰
3. é¼ æ ‡ä¸‹ä¾§é”®ï¼šæ ‡è®°"ä¸ä¼š"ï¼Œè¿›å…¥å›°éš¾æ± 
4. FSRS è®°å½•è¯„åˆ†ï¼Œæ›´æ–°å¤ä¹ è®¡åˆ’

### åç«¯ API

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/listening/today-words` | GET | è·å–ä»Šæ—¥å­¦ä¹ è¯æ±‡ |
| `/listening/review` | POST | FSRS å¤ä¹ è¯„åˆ† |
| `/listening/sessions` | POST/GET | å­¦ä¹ ä¼šè¯ç®¡ç† |
| `/listening/plan` | POST | Gemini å­¦ä¹ è§„åˆ’ |
| `/listening/optimize-queue` | POST | Gemini é˜Ÿåˆ—ä¼˜åŒ– |
| `/settings/playback-rhythm` | GET/PUT | æ’­æ”¾èŠ‚å¥è®¾ç½® |
| `/listening/marks` | POST/DELETE | å•è¯æ ‡è®° |
| `/tts/chinese` | GET | Edge-TTS ä¸­æ–‡åˆæˆ |
| `/listening/prompts` | GET/PUT | Gemini æç¤ºè¯ç®¡ç† |
| `/listening/daily-stats` | GET/POST | æ¯æ—¥å­¦ä¹ ç»Ÿè®¡ |

---

## ğŸ“ æ›´æ–°æ—¥å¿—

| æ—¥æœŸ | å†…å®¹ |
|------|------|
| 2026-01-29 | **å¬åŠ›å·¥åŠå®Œæˆ**ï¼šPhase 1-4 å…¨éƒ¨å®ç°ï¼ŒåŒ…å«é—ªå¡ã€Gemini é›†æˆã€FSRS ç­‰ |
| 2026-01-29 | ä¼˜åŒ– UIï¼šGemini é¢æ¿å’Œæ’­æ”¾èŠ‚å¥æ”¹ä¸ºå¼¹çª—å¼äº¤äº’ |
| 2026-01-29 | **ä¿®å¤å…³é”® Bug**ï¼šAI API è°ƒç”¨è¿”å› 400 INVALID_ARGUMENT é”™è¯¯ |
| 2026-01-29 | å®‰è£…é…ç½® PostgreSQL 17ï¼Œåç«¯é›†æˆæ•°æ®åº“è¯»å†™ |
| 2026-01-29 | å®Œæˆç´ æå·¥åŠåŸå‹ï¼Œæµå¼AIã€çƒ­åŒæ­¥ã€è‡ªåŠ¨å¡«å…… |
| 2026-01-29 | **ä¿®å¤å…³é”® Bug**ï¼šMainLayout æœªè®¾ç½® flex å¯¼è‡´å­é¡µé¢æ— æ³•é“ºæ»¡ |
| 2026-01-28 | åˆ›å»ºéœ€æ±‚æ–‡æ¡£ |
| 2026-01-28 | ç¡®å®šä½¿ç”¨ PostgreSQL |
| 2026-01-28 | å¼€å§‹ç´ æå·¥åŠåŸå‹å¼€å‘ |


---

## âš ï¸ è¸©å‘è®°å½•

### 1. å­é¡µé¢å†…å®¹æ— æ³•é“ºæ»¡å±å¹•

**é—®é¢˜**ï¼šStudio é¡µé¢çš„ Tab åˆ‡æ¢é¢æ¿å§‹ç»ˆæ— æ³•å æ»¡å¯ç”¨é«˜åº¦ï¼Œæ— è®ºæ€ä¹ˆè®¾ç½® `flex: 1` éƒ½ä¸ç”Ÿæ•ˆã€‚

**æ ¹æœ¬åŸå› **ï¼šçˆ¶çº§ `MainLayout` ç»„ä»¶çš„ `.content-area` æ²¡æœ‰è®¾ç½®æ­£ç¡®çš„ flex å¸ƒå±€ï¼Œå¯¼è‡´å­å…ƒç´ çš„ `height: 100%` å’Œ `flex: 1` æ— æ³•è®¡ç®—å‡ºå®é™…é«˜åº¦ã€‚

**ä¿®å¤æ–¹æ¡ˆ**ï¼šä¿®æ”¹ `MainLayout.css`ï¼š

```css
.main-content {
    height: 100vh;           /* å›ºå®šè§†å£é«˜åº¦ */
    display: flex;           /* å¯ç”¨ flex */
    flex-direction: column;
}

.content-area {
    flex: 1;                 /* å æ»¡å‰©ä½™ç©ºé—´ */
    display: flex;
    flex-direction: column;
    min-height: 0;           /* å…³é”®ï¼å…è®¸ flex å­å…ƒç´ æ”¶ç¼© */
    overflow: hidden;
}
```

**æ•™è®­**ï¼šåœ¨åµŒå¥— flex å¸ƒå±€ä¸­ï¼Œ**æ¯ä¸€å±‚**éƒ½å¿…é¡»è®¾ç½®ï¼š
1. `display: flex` + `flex-direction: column`
2. `flex: 1` (å æ»¡çˆ¶å®¹å™¨)
3. `min-height: 0` (å…è®¸æ”¶ç¼©ï¼Œå¦åˆ™å†…å®¹ä¼šæ’‘å¼€)
4. `overflow: hidden` (é˜²æ­¢æº¢å‡º)

åªåœ¨æœ€åº•å±‚è®¾ç½® `flex: 1` æ˜¯æ²¡ç”¨çš„ï¼Œå¿…é¡»ä»æ ¹å®¹å™¨ä¸€è·¯è®¾ç½®åˆ°å¶å­èŠ‚ç‚¹ã€‚

---

### 2. AI API è°ƒç”¨è¿”å› 400 INVALID_ARGUMENT

**é—®é¢˜**ï¼šè°ƒç”¨ Gemini API æ—¶è¿”å› `{"error": {"code": 400, "message": "Request contains an invalid argument.", "status": "INVALID_ARGUMENT"}}`ã€‚

**è¯¯å¯¼æ–¹å‘**ï¼š
- æœ€åˆä»¥ä¸ºæ˜¯ `prompts.json` æ–‡ä»¶è¢«çƒ­åŒæ­¥æœºåˆ¶æŸåï¼ˆå®é™…ä¸Šæ–‡ä»¶æ˜¯æ­£å¸¸çš„ï¼‰
- å°è¯•äº†åŸå­å†™å…¥ã€ç®€åŒ–æç¤ºè¯ç­‰æ–¹æ¡ˆå‡æ— æ•ˆ

**æ ¹æœ¬åŸå› **ï¼šè¯·æ±‚ä½“ç¼ºå°‘ `max_tokens` å‚æ•°ï¼

Gemini APIï¼ˆé€šè¿‡ Antigravity Tools åä»£ï¼‰åœ¨æ²¡æœ‰ `max_tokens` æ—¶ä¼šè¿”å› 400 é”™è¯¯ã€‚è¿™ä¸ OpenAI API çš„è¡Œä¸ºä¸åŒï¼ˆOpenAI å…è®¸çœç•¥æ­¤å‚æ•°ï¼‰ã€‚

**ä¿®å¤æ–¹æ¡ˆ**ï¼šåœ¨è¯·æ±‚ä½“ä¸­æ·»åŠ  `max_tokens` å‚æ•°ï¼š

```javascript
const requestBody = {
    model: 'gemini-3-flash',
    messages: [...],
    temperature: 0.7,
    max_tokens: 60000,  // â† å¿…é¡»æ·»åŠ ï¼
    stream: true,
};
```

**é™„åŠ å‘ç°**ï¼š
- Python `httpx` åº“å‘èµ·çš„è¯·æ±‚è¢« Antigravity Tools åä»£æ‹’ç»ï¼ˆè¿”å› 400ï¼‰
- ä½†**æµè§ˆå™¨ `fetch` å‘èµ·çš„ç›¸åŒè¯·æ±‚**å¯ä»¥æˆåŠŸ
- å› æ­¤æœ€ç»ˆæ–¹æ¡ˆæ˜¯å°† AI è°ƒç”¨ä»åç«¯è½¬ç§»åˆ°å‰ç«¯ï¼ˆç›´æ¥ä»æµè§ˆå™¨è°ƒç”¨åä»£ï¼‰

**æ•™è®­**ï¼š
1. ä¸åŒ API å¯¹å¿…éœ€å‚æ•°çš„è¦æ±‚ä¸åŒï¼Œè°ƒç”¨æ–° API æ—¶æ³¨æ„æŸ¥é˜…æ–‡æ¡£
2. å½“åç«¯ä»£ç†è°ƒç”¨å¤±è´¥æ—¶ï¼Œå¯ä»¥è€ƒè™‘å‰ç«¯ç›´æ¥è°ƒç”¨ï¼ˆé€‚ç”¨äºæœ¬åœ°å¼€å‘ç¯å¢ƒï¼‰
3. å¯¹æ¯”èƒ½å·¥ä½œçš„é¡¹ç›®ï¼ˆmy-storyï¼‰å’Œä¸èƒ½å·¥ä½œçš„é¡¹ç›®ï¼Œæ‰¾å‡ºè¯·æ±‚å·®å¼‚æ˜¯æœ‰æ•ˆçš„è°ƒè¯•æ–¹æ³•
---

### 3. ç´ æå·¥åŠ â†’ å¬åŠ›å·¥åŠï¼šå®Œæ•´æ•°æ®æµè®¾è®¡

**é—®é¢˜èƒŒæ™¯**ï¼šå½“å‰ `useAudioPlayer` ä¸­çš„ `playEnglishClip` ç›´æ¥æ’­æ”¾ `audio_file_id` å¯¹åº”çš„å®Œæ•´éŸ³é¢‘æ–‡ä»¶ï¼Œæœªåˆ©ç”¨ `audio_start` å’Œ `audio_end` è¿›è¡Œåˆ‡ç‰‡ã€‚å¦‚æœç´ ææ˜¯é•¿éŸ³é¢‘ï¼ˆåŒ…å«å¤šä¸ªå•è¯ï¼‰ï¼Œç”¨æˆ·å­¦ä¹ å•ä¸ªå•è¯æ—¶ä¼šå¬åˆ°æ•´æ®µå½•éŸ³ï¼Œä½“éªŒå®Œå…¨é”™è¯¯ã€‚

**æ ¹æœ¬åŸå› **ï¼šç³»ç»Ÿç¼ºå°‘ä»"éŸ³é¢‘ä¸Šä¼ "åˆ°"è¯æ±‡å­¦ä¹ "çš„å®Œæ•´æ•°æ®é“¾è·¯è®¾è®¡ã€‚

---

#### ğŸ“Š Whisper æ—¶é—´æˆ³èƒ½åŠ›åˆ†æ

```python
# Whisper pipeline æ”¯æŒä¸¤ç§æ—¶é—´æˆ³æ¨¡å¼
result = pipe(audio_path, return_timestamps=True)      # å¥å­çº§ï¼ˆé»˜è®¤ï¼‰
result = pipe(audio_path, return_timestamps="word")    # å•è¯çº§ âœ…

# å•è¯çº§è¾“å‡ºæ ¼å¼
{
    "text": "She's waiting in line at a food truck.",
    "chunks": [
        {"timestamp": [0.0, 0.42], "text": "She's"},
        {"timestamp": [0.42, 0.78], "text": "waiting"},
        {"timestamp": [0.78, 1.02], "text": "in"},
        {"timestamp": [1.02, 1.28], "text": "line"},
        {"timestamp": [1.28, 1.56], "text": "at"},
        {"timestamp": [1.56, 1.82], "text": "a"},
        {"timestamp": [1.82, 2.18], "text": "food"},
        {"timestamp": [2.18, 2.68], "text": "truck."}
    ]
}
```

**ç»“è®º**ï¼šWhisper å¯ä»¥æä¾›å•è¯çº§æ—¶é—´æˆ³ï¼Œä½†éœ€è¦ä¿®æ”¹ `process_transcription()` å‡½æ•°å¯ç”¨ `return_timestamps="word"`ã€‚

---

#### ğŸ”„ å®Œæ•´æ•°æ®æµè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç´ æå·¥åŠ (Studio) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  1. ä¸Šä¼ éŸ³é¢‘                                                            â”‚
â”‚     â””â”€â†’ Whisper è½¬å†™ (return_timestamps="word")                         â”‚
â”‚         â””â”€â†’ å­˜å…¥ AudioFiles.transcription (JSONB)                       â”‚
â”‚             â””â”€â†’ æ˜¾ç¤ºåœ¨"è¾“å…¥å†…å®¹"é¢æ¿                                    â”‚
â”‚                                                                         â”‚
â”‚  2. AI æå–è¯æ±‡                                                         â”‚
â”‚     â””â”€â†’ ç”¨æˆ·ç‚¹å‡»"å‘é€ç»™ AI"                                             â”‚
â”‚         â””â”€â†’ Gemini è¿”å› JSON [{text, type, meaning, context}, ...]     â”‚
â”‚             â””â”€â†’ æ˜¾ç¤ºåœ¨"AI è¿”å›"é¢æ¿                                     â”‚
â”‚                                                                         â”‚
â”‚  3. è¯æ±‡å…¥åº“ï¼ˆæ–°å¢åŠŸèƒ½ï¼‰                                                â”‚
â”‚     â””â”€â†’ ç”¨æˆ·ç‚¹å‡»"ä¿å­˜åˆ°è¯æ±‡åº“"æŒ‰é’®                                     â”‚
â”‚         â””â”€â†’ å‰ç«¯è°ƒç”¨ POST /vocabulary/batch                            â”‚
â”‚             â””â”€â†’ åç«¯åŒ¹é…æ—¶é—´æˆ³ï¼ˆå…³é”®æ­¥éª¤ï¼ï¼‰                           â”‚
â”‚                 â””â”€â†’ å­˜å…¥ Vocabulary è¡¨                                  â”‚
â”‚                     â”œâ”€ audio_file_id  (å…³è”éŸ³é¢‘)                       â”‚
â”‚                     â”œâ”€ audio_start    (å•è¯å¼€å§‹æ—¶é—´)                   â”‚
â”‚                     â”œâ”€ audio_end      (å•è¯ç»“æŸæ—¶é—´)                   â”‚
â”‚                     â”œâ”€ english        (è‹±æ–‡)                           â”‚
â”‚                     â”œâ”€ chinese        (ä¸­æ–‡é‡Šä¹‰)                       â”‚
â”‚                     â”œâ”€ context        (åŸå¥ä¸Šä¸‹æ–‡)                     â”‚
â”‚                     â””â”€ word_type      (phrase/noun/verb...)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å¬åŠ›å·¥åŠ (Listening) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  4. è¯æ±‡åˆ—è¡¨å±•ç¤º                                                        â”‚
â”‚     â””â”€â†’ GET /vocabulary?filter=today                                   â”‚
â”‚         â””â”€â†’ æŒ‰ Tab åˆ†ç»„æ˜¾ç¤º (çŸ­è¯­/è¯æ±‡/ä¸ä¼šçš„/å…¨éƒ¨)                     â”‚
â”‚                                                                         â”‚
â”‚  5. éŸ³é¢‘æ’­æ”¾ï¼ˆæ ¸å¿ƒé—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼‰                                      â”‚
â”‚     â””â”€â†’ ç”¨æˆ·ç‚¹å‡»æ’­æ”¾æˆ–è‡ªåŠ¨è½®æ’­                                         â”‚
â”‚         â””â”€â†’ å‰ç«¯è·å– audio_file_id, audio_start, audio_end             â”‚
â”‚             â”œâ”€ æ–¹æ¡ˆA: Web Audio API åˆ‡ç‰‡æ’­æ”¾                           â”‚
â”‚             â”‚   â””â”€â†’ audioContext.createBufferSource()                  â”‚
â”‚             â”‚       â””â”€â†’ source.start(0, audio_start, duration)         â”‚
â”‚             â””â”€ æ–¹æ¡ˆB: åç«¯åˆ‡ç‰‡æœåŠ¡ï¼ˆå¤‡é€‰ï¼‰                              â”‚
â”‚                 â””â”€â†’ GET /audio/clip?id={}&start={}&end={}              â”‚
â”‚                     â””â”€â†’ ffmpeg åˆ‡ç‰‡è¿”å›éŸ³é¢‘æµ                          â”‚
â”‚                                                                         â”‚
â”‚  6. å­¦ä¹ æµç¨‹                                                            â”‚
â”‚     â”œâ”€â†’ ç£¨è€³æœµ: è‹±è¯­3é â†’ ä¸­æ–‡1é â†’ ä¸‹ä¸€ä¸ª                             â”‚
â”‚     â””â”€â†’ è€ƒæ ¸: è‹±è¯­1é â†’ ä¾§é”®è¯„åˆ† â†’ FSRS æ›´æ–°                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### ğŸ”§ å…³é”®å®ç°æ­¥éª¤

**Step 1: ä¿®æ”¹ Whisper è½¬å†™ï¼Œå¯ç”¨å•è¯çº§æ—¶é—´æˆ³**

```python
# server.py - process_transcription()
result = pipe(
    audio_path,
    generate_kwargs={"language": "english"},
    return_timestamps="word"  # â† å¯ç”¨å•è¯çº§æ—¶é—´æˆ³
)
```

**Step 2: æ–°å¢"ä¿å­˜åˆ°è¯æ±‡åº“"API**

```python
# POST /vocabulary/batch
# è¯·æ±‚ä½“
{
    "audio_file_id": "uuid",
    "items": [
        {"text": "waiting in line", "meaning": "æ’é˜Ÿç­‰å€™", "type": "phrase", "context": "..."}
    ]
}

# åç«¯é€»è¾‘
1. è·å– AudioFiles.transcription (å•è¯çº§æ—¶é—´æˆ³)
2. å¯¹äºæ¯ä¸ª item:
   - åœ¨ transcription ä¸­æœç´¢åŒ¹é…çš„å•è¯/çŸ­è¯­
   - è®¡ç®— audio_start = ç¬¬ä¸€ä¸ªåŒ¹é…å•è¯çš„ start
   - è®¡ç®— audio_end = æœ€åä¸€ä¸ªåŒ¹é…å•è¯çš„ end
3. å­˜å…¥ Vocabulary è¡¨
```

**Step 3: å‰ç«¯ Web Audio API åˆ‡ç‰‡æ’­æ”¾**

```typescript
// useAudioPlayer.ts
async function playClip(audioUrl: string, start: number, end: number) {
    const response = await fetch(audioUrl);
    const arrayBuffer = await response.arrayBuffer();
    const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
    
    const source = audioContext.createBufferSource();
    source.buffer = audioBuffer;
    source.connect(audioContext.destination);
    source.start(0, start, end - start);  // â† å…³é”®ï¼šåªæ’­æ”¾ start åˆ° end
}
```

---

#### âš ï¸ çŸ­è¯­æ—¶é—´æˆ³åŒ¹é…çš„è¾¹ç•Œé—®é¢˜

**é—®é¢˜**ï¼šçŸ­è¯­å¦‚ "waiting in line" ç”±å¤šä¸ªå•è¯ç»„æˆï¼Œå¦‚ä½•ç¡®å®šå…¶æ—¶é—´èŒƒå›´ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å°†çŸ­è¯­æ‹†åˆ†ä¸ºå•è¯åºåˆ— `["waiting", "in", "line"]`
2. åœ¨ Whisper æ—¶é—´æˆ³ä¸­æœç´¢**è¿ç»­åŒ¹é…**çš„å•è¯åºåˆ—
3. audio_start = ç¬¬ä¸€ä¸ªå•è¯ "waiting" çš„ start
4. audio_end = æœ€åä¸€ä¸ªå•è¯ "line" çš„ end

```python
def find_phrase_timestamps(phrase: str, word_timestamps: list) -> tuple:
    words = phrase.lower().split()
    for i in range(len(word_timestamps) - len(words) + 1):
        match = True
        for j, word in enumerate(words):
            if word_timestamps[i+j]["text"].lower().strip(".,!?") != word:
                match = False
                break
        if match:
            return (word_timestamps[i]["timestamp"][0], 
                    word_timestamps[i+len(words)-1]["timestamp"][1])
    return (None, None)  # æœªæ‰¾åˆ°åŒ¹é…
```

---

#### ğŸ“‹ å¾…å®ç°æ¸…å•

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | çŠ¶æ€ |
|--------|------|------|
| P0 | ä¿®æ”¹ Whisper å¯ç”¨ `return_timestamps="word"` | âœ… å®Œæˆ |
| P0 | æ–°å¢ `POST /vocabulary/batch` API | âœ… å®Œæˆ |
| P0 | å®ç°çŸ­è¯­æ—¶é—´æˆ³åŒ¹é…ç®—æ³• | âœ… å®Œæˆ |
| P1 | ç´ æå·¥åŠæ·»åŠ "ä¿å­˜åˆ°è¯æ±‡åº“"æŒ‰é’® | â³ |
| P1 | å¬åŠ›å·¥åŠ Web Audio API åˆ‡ç‰‡æ’­æ”¾ | â³ |
| P2 | åç«¯ ffmpeg åˆ‡ç‰‡æœåŠ¡ï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰ | â³ |
